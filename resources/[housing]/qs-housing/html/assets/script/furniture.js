const _0x2b22fd=_0x2421;!function(){for(var n=_0x2421,e=_0x18a1();;)try{if(217973==+parseInt(n(551))+parseInt(n(493))/2+-parseInt(n(424))/3+parseInt(n(444))/4*(parseInt(n(568))/5)+-parseInt(n(416))/6*(-parseInt(n(525))/7)+parseInt(n(417))/8+-parseInt(n(523))/9*(parseInt(n(497))/10))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();import{Post,getOwnedObjects}from"./api.js";function _0x2421(n,e){const t=_0x18a1();return(_0x2421=function(n,e){return n-=389,t[n]})(n,e)}import*as _0x4e47c4 from"three";import{TransformControls}from"three/addons/controls/TransformControls.js";let decorateMenu=null,editable=!1,editingData={};function setDecorateMenu(n){decorateMenu=n}const tracking={x:0,y:0},objectInfos={},furniData={prevY:[],prevX:[],prevZ:[],prevPitch:[],prevRoll:[],prevYaw:[]};let isTransforming=!1,editingId=null;const degToRad=n=>{var e=_0x2421,t={WqRPI:function(n,e){return n*e},BtbTa:function(n,e){return n/e}};return t[e(448)](n,t[e(510)](Math.PI,180))},radToDeg=n=>{var e=_0x2421,t={gQxTo:function(n,e){return n*e},zNJwV:function(n,e){return n/e}};return t[e(577)](n,t[e(499)](180,Math.PI))},mouseDownHandler=async n=>{var e=_0x2421,t={QFpAw:function(n,e){return n&&e},GoVCT:function(n,e){return n!==e},UcWtI:e(516),SEXlP:function(n,e,t){return n(e,t)},iKnsI:e(389)+e(571),pCpcL:function(n,e){return n!==e},aDBKg:function(n,e){return n!=e},TSSNd:function(n,e){return n==e},WpPAm:function(n){return n()},UoyUT:function(n,e){return n<e},aHwre:function(n,e){return n!=e},JDChb:function(n){return n()},QpyUb:function(n,e){return n(e)},oHrLo:e(547),raxaU:function(n,e){return n!=e}};if(!(isTransforming=!t[e(495)](isTransforming,!editingId)&&isTransforming)&&!t[e(548)](n[e(564)][e(503)],t[e(453)])){var n=tracking.x,r=tracking.y,o=await t[e(555)](Post,t[e(395)],{x:n,y:r});if(o[e(412)]&&t[e(496)](editingId,o[e(550)]))if(t[e(447)](decorateMenu,null)&&t[e(519)](decorateMenu[e(583)],2)){var a=await t[e(535)](getOwnedObjects);if(!t[e(519)](a[decorateMenu[e(498)][e(529)+"u"][e(455)]][e(402)],o[e(550)])){for(var i=null,c=0;t[e(586)](c,a[e(482)]);c++)if(t[e(519)](a[c][e(402)],o[e(550)])){i=c;break}t[e(407)](i,null)&&(decorateMenu[e(498)][e(529)+"u"][e(455)]=i),decorateMenu[e(498)][e(529)+"u"][e(583)]()}}else t[e(553)](clearData),editingId=o[e(550)],t[e(468)](changeEntity,editingId),isTransforming=!1;else if(!o[e(412)]){var s=t[e(559)][e(528)]("|");let n=0;for(;;){switch(s[n++]){case"0":transformControls[e(526)]=!1;continue;case"1":editingId=null;continue;case"2":isTransforming=!1;continue;case"3":t[e(535)](clearData);continue;case"4":if(t[e(585)](decorateMenu,null)&&t[e(519)](decorateMenu[e(583)],2))return;continue}break}}}},handleTracking=(window[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(458),mouseDownHandler),n=>{var e=_0x2b22fd,t={ZIUeG:function(n,e){return n-e},uRvib:function(n,e){return n-e},rsoye:function(n,e,t){return n(e,t)}},r=t[e(576)](n[e(594)],n[e(564)][e(544)]),n=t[e(459)](n[e(524)],n[e(564)][e(544)]);tracking.x=t[e(502)](normalize,r,document[e(433)+e(588)][e(466)+"h"]),tracking.y=t[e(502)](normalize,n,document[e(433)+e(588)][e(398)+"ht"])}),Scene=new _0x4e47c4[_0x2b22fd(419)],Renderer=new _0x4e47c4[_0x2b22fd(563)+_0x2b22fd(467)]({alpha:!0}),Camera=(Renderer[_0x2b22fd(581)](window[_0x2b22fd(515)],window[_0x2b22fd(582)+"t"]),document[_0x2b22fd(546)+_0x2b22fd(521)](_0x2b22fd(534))[_0x2b22fd(483)+"d"](Renderer[_0x2b22fd(572)]),new _0x4e47c4[_0x2b22fd(476)+_0x2b22fd(552)](50,window[_0x2b22fd(515)]/window[_0x2b22fd(582)+"t"],.1,1e4)),boxGeometry=(Camera[_0x2b22fd(514)][_0x2b22fd(418)]=_0x2b22fd(554),new _0x4e47c4[_0x2b22fd(465)+"y"](1,1,1)),meshPhongMaterial=new _0x4e47c4[_0x2b22fd(462)+_0x2b22fd(440)]({color:16711935,transparent:!0,opacity:0}),Mesh=new _0x4e47c4[_0x2b22fd(518)](boxGeometry,meshPhongMaterial);Mesh[_0x2b22fd(514)][_0x2b22fd(418)]=_0x2b22fd(554),Mesh[_0x2b22fd(479)][_0x2b22fd(504)](1,1,1),Scene[_0x2b22fd(478)](Mesh),Renderer[_0x2b22fd(572)][_0x2b22fd(533)][_0x2b22fd(399)]=_0x2b22fd(509);let animationFrameActive=null;function renderGeometry(){var n=_0x2b22fd;animationFrameActive={XTevK:function(n,e){return n(e)}}[n(413)](requestAnimationFrame,renderGeometry),Renderer[n(520)](Scene,Camera)}function showGeometry(){var n=_0x2b22fd,e={zhTim:n(490)};transformControls[n(526)]=!1,Renderer[n(572)][n(533)][n(399)]=e[n(590)]}function hideGeometry(){var n=_0x2b22fd,e={GdOxg:n(509)};transformControls[n(526)]=!1,Renderer[n(572)][n(533)][n(399)]=e[n(549)]}function hideTransformControls(){var n=_0x2b22fd;transformControls[n(526)]=!1}const transformControls=new TransformControls(Camera,Renderer[_0x2b22fd(572)]);function _0x18a1(){const n=["SGCdr","MmUyY","exists","ty-yaw","documentEl","5|0|1|2|4|","key","fQzUV","OKuni","eBKCZ","lJSMW","aterial","SpFwn","yvHAm","toggleMous","51236kdRfSj","yZjsY","qoIEu","aDBKg","WqRPI","XSuUL","CkkjZ","setTransla","zflFQ","UcWtI","lper #enti","stash","push","prevX","mousedown","uRvib","ty-z","load_entit","MeshPhongM","ectionMatr","vHsJc","BoxGeometr","scrollWidt","rer","QpyUb","cUmyo","YOrjN","MtllS","Qbbfj","nSnap","ty-x","5|1|2|3|4|","Perspectiv","translate","add","scale","pjmZm","prevZ","length","appendChil","prevPitch","0|0|1|15|7","toggleCurs","attach","nJeMb","yaw","block","val","LDBWY","539104Khsgoe","VhMDa","QFpAw","pCpcL","92460WvtEZz","categories","zNJwV","prevRoll","prevYaw","rsoye","tagName","set","addEventLi","fcPCT","y_info","CMzCV","none","BtbTa","ty-roll","rDdek","ANkcE","rotation","innerWidth","CANVAS","Pcbft","Mesh","TSSNd","render","tor","alpha","306gEedzn","pageY","14UbnVDd","visible","1|3|2|4|0|","split","sortingMen","updateProj","VCWqa","ty-pitch","style","#decorate","WpPAm","mOxQD","ground_obj","sVUTc","fov","PVkRx","mousemove","setRotatio","lper #mode","offsetTop","hsfYt","querySelec","4|3|1|0|2","GoVCT","GdOxg","entity","127758YAuBxt","eCamera","JDChb","YZX","SEXlP","mgHub","mouseDown","ect","oHrLo","setMode","fhDMP","roll","WebGLRende","target","kmAeM","prevY","change","30nPzJuh","6|5","edit_entit","ity","domElement","FmGaB","NxfHq","ty-y","ZIUeG","gQxTo","LiZvK","SZIoo","rotate","setSize","innerHeigh","sort","hsNjV","raxaU","UoyUT","QjJPf","ement","keydown","zhTim","gRPEU","|2|4|11","aBqIl","pageX","BYpma","select_ent","HKemv","position","cam","eMovement","hmxYq","iKnsI","l-name","vcxos","scrollHeig","display","#object-he","SLeIq","object","AAjCQ","distance","tionSnap","TmzlK","aHwre","eyNti","kiWzi","Vxjbk","13|3|6|9|1","hit","XTevK","WITNL","|14|12|5|8","120552dydBPY","1520088ezqtoD","order","Scene","pitch","stener","BFKCo","hash","516066KDKxBh","UXhyE","qvAcw","EjPzs","mouseUp"];return(_0x18a1=function(){return n})()}transformControls[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(567),()=>{var n=_0x2b22fd,e={vHsJc:function(n,e){return n(e)},VCWqa:function(n,e){return n(e)},VhMDa:function(n){return n()}},t=objectInfos[editingId];Mesh[n(391)].x&&Mesh[n(391)].y&&Mesh[n(391)].z&&t&&(t.x=Mesh[n(391)].x,t.y=-Mesh[n(391)].z,t.z=Mesh[n(391)].y,t[n(420)]=e[n(464)](radToDeg,Mesh[n(514)].x),t[n(562)]=e[n(464)](radToDeg,-Mesh[n(514)].z),t[n(489)]=e[n(531)](radToDeg,Mesh[n(514)].y),e[n(494)](editEntity),Renderer[n(520)](Scene,Camera))});const editEntity=()=>{var n=_0x2b22fd,e={BFKCo:function(n,e,t){return n(e,t)},AAjCQ:n(570)+"y",rDdek:function(n,e){return n(e)},ANkcE:function(n,e){return n(e)},hsNjV:function(n,e){return n(e)},gRPEU:function(n,e){return n(e)},MtllS:function(n,e){return n(e)}},t=objectInfos[editingId];e[n(422)](Post,e[n(403)],{id:editingId,alpha:e[n(512)](parseInt,t[n(522)]),x:e[n(512)](parseFloat,t.x),y:e[n(513)](parseFloat,t.y),z:e[n(584)](parseFloat,t.z),pitch:e[n(584)](parseFloat,t[n(420)]),roll:e[n(513)](parseFloat,t[n(562)]),yaw:e[n(591)](parseFloat,t[n(489)])}),e[n(471)](setObjectHelperValues,t)},storeData=(transformControls[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(557),()=>{var n=_0x2b22fd;isTransforming=!0,{yZjsY:function(n){return n()}}[n(445)](storeData)}),transformControls[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(428),()=>{var n=_0x2b22fd,e=objectInfos[editingId];e&&(e.x=Mesh[n(391)].x,e.y=-Mesh[n(391)].z,e.z=Mesh[n(391)].y,isTransforming=!1)}),transformControls[_0x2b22fd(451)+_0x2b22fd(405)](.1),transformControls[_0x2b22fd(581)](.8),transformControls[_0x2b22fd(542)+_0x2b22fd(473)](degToRad(15)),transformControls[_0x2b22fd(487)](Mesh),Scene[_0x2b22fd(478)](transformControls),()=>{var e=_0x2b22fd,t={pjmZm:function(n,e){return n!==e},EjPzs:function(n,e){return n!==e},SGCdr:function(n,e){return n!==e},SpFwn:e(475)+"0"},r=objectInfos[editingId];if(r&&t[e(480)](r.x,0)&&t[e(427)](r.y,0)&&t[e(429)](r.z,0)){var o=t[e(441)][e(528)]("|");let n=0;for(;;){switch(o[n++]){case"0":furniData[e(501)][e(456)](r[e(489)]);continue;case"1":furniData[e(566)][e(456)](r.y);continue;case"2":furniData[e(481)][e(456)](r.z);continue;case"3":furniData[e(484)][e(456)](r[e(420)]);continue;case"4":furniData[e(500)][e(456)](r[e(562)]);continue;case"5":furniData[e(457)][e(456)](r.x);continue}break}}});function cancelRenderGeometry(){var n=_0x2b22fd;animationFrameActive&&({PVkRx:function(n,e){return n(e)}}[n(540)](cancelAnimationFrame,animationFrameActive),animationFrameActive=null)}function setEditMode(n){var e=_0x2b22fd,t={yvHAm:function(n,e){return n===e},lJSMW:e(580),eyNti:e(477)};t[e(442)](n,t[e(439)])?transformControls[e(560)](t[e(439)]):transformControls[e(560)](t[e(408)])}function setRotationSnap(n){var e=_0x2b22fd;transformControls[e(542)+e(473)](n)}function setTranslationSnap(n){var e=_0x2b22fd;transformControls[e(451)+e(405)](n)}const normalize=(n,e)=>{var t=_0x2b22fd,r={CkkjZ:function(n,e){return n+e},BYpma:function(n,e){return n/e},eBKCZ:function(n,e){return n*e},NxfHq:function(n,e){return n-e}};return r[t(450)](r[t(595)](r[t(438)](1,r[t(574)](n,0)),r[t(574)](e,0)),0)},handleUpdatePositions=(window[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(541),handleTracking),n=>{var e=_0x2b22fd,t={kiWzi:function(n,e){return n(e)},UXhyE:function(n,e,t){return n(e,t)},WITNL:function(n,e){return n(e)},fQzUV:function(n,e){return n(e)}},r=(Camera[e(391)][e(504)](n[e(392)][e(391)].x,n[e(392)][e(391)].z,-n[e(392)][e(391)].y),n[e(392)][e(514)].x),o=n[e(392)][e(514)].z,a=n[e(392)][e(514)].y;Camera[e(514)][e(504)](t[e(409)](degToRad,r),t[e(409)](degToRad,t[e(425)](zRotationHandler,r,o)),t[e(414)](degToRad,a)),Camera[e(539)]=n[e(392)][e(539)],Camera[e(530)+e(463)+"ix"](),n[e(550)][e(391)]&&(Mesh[e(391)][e(504)](n[e(550)][e(391)].x,n[e(550)][e(391)].z,-n[e(550)][e(391)].y),Mesh[e(514)][e(504)](t[e(414)](degToRad,n[e(550)][e(514)].x),t[e(436)](degToRad,n[e(550)][e(514)].z),t[e(414)](degToRad,-n[e(550)][e(514)].y)))}),changeEntity=async n=>{var e=_0x2b22fd,t={mOxQD:function(n,e,t){return n(e,t)},hsfYt:e(461)+e(507),TmzlK:function(n,e){return n(e)}},n=await t[e(536)](Post,t[e(545)],{id:t[e(406)](parseInt,n)});t[e(406)](setEntityData,n)},zRotationHandler=(n,e)=>{var t=_0x2b22fd,r={Pcbft:function(n,e){return e<n},HKemv:function(n,e){return n<e},qoIEu:function(n,e){return e<n}};return(!r[t(517)](n,0)||!r[t(390)](n,90))&&(r[t(517)](n,-180)&&r[t(390)](n,-90)||r[t(446)](n,0))?-e:e},setEntityData=n=>{var e=_0x2b22fd,t={kmAeM:e(411)+e(485)+e(415)+e(592),nJeMb:function(n,e){return n!==e},YOrjN:function(n){return n()},MmUyY:function(n,e){return n(e)}},r=t[e(565)][e(528)]("|");let o=0;for(;;){switch(r[o++]){case"0":editingData[e(423)]=n[e(423)];continue;case"1":editingData[e(522)]=n[e(522)];continue;case"2":editingData[e(404)]=n[e(404)];continue;case"3":t[e(488)](editingId,n.id)&&t[e(470)](clearData);continue;case"4":transformControls[e(526)]=!0;continue;case"5":editingData[e(562)]=n[e(562)];continue;case"6":editable=!0;continue;case"7":editingData.y=n.y;continue;case"8":editingData[e(489)]=n[e(489)];continue;case"9":editingId=n.id;continue;case"10":objectInfos[editingId]={id:n.id,hash:n[e(423)],alpha:n[e(522)],x:n.x,y:n.y,z:n.z,pitch:n[e(420)],roll:n[e(562)],yaw:n[e(489)],distance:n[e(404)],quaternion:{}};continue;case"11":t[e(430)](setObjectHelperValues,n);continue;case"12":editingData[e(420)]=n[e(420)];continue;case"13":if(n[e(431)])continue;return editable=!1,void(transformControls[e(526)]=!1);case"14":editingData.z=n.z;continue;case"15":editingData.x=n.x;continue}break}},setObjectHelperValues=n=>{var e=_0x2b22fd,t={aBqIl:e(527)+e(569),LDBWY:function(n,e){return n(e)},zflFQ:e(400)+e(454)+e(532),fcPCT:function(n,e){return n(e)},mgHub:e(400)+e(543)+e(396),cUmyo:function(n,e){return n(e)},LiZvK:e(400)+e(454)+e(575),Vxjbk:function(n,e){return n(e)},fhDMP:e(400)+e(454)+e(474),hmxYq:function(n,e){return n(e)},Qbbfj:e(400)+e(454)+e(460),sVUTc:e(400)+e(454)+e(432),qvAcw:e(400)+e(454)+e(511)},r=t[e(593)][e(528)]("|");let o=0;for(;;){switch(r[o++]){case"0":t[e(492)]($,t[e(452)])[e(491)](n[e(420)]);continue;case"1":t[e(506)]($,t[e(556)])[e(491)](n[e(423)]);continue;case"2":t[e(469)]($,t[e(578)])[e(491)](n.y);continue;case"3":t[e(410)]($,t[e(561)])[e(491)](n.x);continue;case"4":t[e(394)]($,t[e(472)])[e(491)](n.z);continue;case"5":t[e(492)]($,t[e(538)])[e(491)](n[e(489)]);continue;case"6":t[e(394)]($,t[e(426)])[e(491)](n[e(562)]);continue}break}},clearData=()=>{var n=_0x2b22fd,e={QjJPf:n(434)+"3"}[n(587)][n(528)]("|");let t=0;for(;;){switch(e[t++]){case"0":furniData[n(457)]=[];continue;case"1":furniData[n(481)]=[];continue;case"2":furniData[n(484)]=[];continue;case"3":furniData[n(501)]=[];continue;case"4":furniData[n(500)]=[];continue;case"5":furniData[n(566)]=[];continue}break}};window[_0x2b22fd(505)+_0x2b22fd(421)](_0x2b22fd(589),async n=>{var e=_0x2b22fd,t={SLeIq:function(n,e){return n===e},CMzCV:function(n,e){return n(e)},FmGaB:e(443)+e(393),OKuni:e(486)+"or",SZIoo:function(n,e,t){return n(e,t)},XSuUL:e(537)+e(558),vcxos:function(n,e){return n(e)}};t[e(401)](n[e(435)],"F6")&&t[e(508)](Post,t[e(573)]),t[e(401)](n[e(435)],"F5")&&t[e(508)](Post,t[e(437)]),(t[e(401)](n[e(435)],"G")||t[e(401)](n[e(435)],"g"))&&(n=await t[e(579)](Post,t[e(449)],{id:t[e(508)](parseInt,editingId)}),t[e(397)](setEntityData,n))});export{setDecorateMenu,renderGeometry,showGeometry,hideGeometry,hideTransformControls,cancelRenderGeometry,setEditMode,setRotationSnap,setTranslationSnap,handleUpdatePositions,changeEntity};