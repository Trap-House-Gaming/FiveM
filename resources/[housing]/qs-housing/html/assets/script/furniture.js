const _0x192837=_0x15a4;function _0x48e5(){const n=["ty-x","pitch","ity","add","stener","ty-roll","1gfUzEa","jixtf","edit_entit","hyNqo","none","ypOpk","wpJEH","fov","prevRoll","y_info","RsKBh","wJCJT","npLtk","tionSnap","cInWA","8|11|7|5|1","CaaHF","select_ent","QnSrM","35SHKibG","toggleCurs","prevY","ty-y","aPeSm","setSize","RScsN","keydown","eMovement","val","beJlZ","MIcmc","addEventLi","mousedown","pageX","split","push","MfuhD","lper #enti","gJHpl","hmTTQ","innerHeigh","qnxlJ","ectionMatr","ground_obj","setMode","sHmHH","hfcNU","dVdzv","#object-he","494800RnMyAs","fujcI","AOCPr","mousemove","XVghg","lper #mode","Scene","flQHa","tagName","change","mouseUp","hit","Perspectiv","165eCGzzx","BaXPk","sort","yceOc","YBXwB","YZX","DCVfU","fKtKu","prevYaw","BoxGeometr","prevX","entity","oeWHo","GzKaC","QwSEY","scrollHeig","9OAqmtv","xpGTv","rEZhx","ement","649738HMchyN","1|3|0|2|6|","aterial","iqPgo","sbhhR","rer","AIvfu","NUymp","jjbfy","length","1226860BsFfIF","TStww","IFchw","display","MeshPhongM","scrollWidt","block","4|3|2|1|0","24OamkvM","visible","nSnap","order","rotation","roll","5|4","aludV","MHKXD","dJFaJ","XbRyP","SBkJr","LIVDl","WebGLRende","sortingMen","stash","mwrsr","alpha","10|12|13|1","DdTlJ","CANVAS","load_entit","5|4|1|2|0|","gpUVN","45198aioNsn","XTMnS","0|4|3|5|2|","tJhdZ","render","XepOw","5|4|2|3|0|","ixfac","ty-yaw","mouseDown","ISuXF","ppRNg","appendChil","setTransla","qnKtM","pageY","hLIUa","prevPitch","WWccf","yaw","BtwGE","gCYaf","afEHu","cam","qrZao","ZVnpY","offsetTop","mZaTI","ty-z","set","WmANU","categories","IsfSI","Mesh","xpWpz","documentEl","toggleMous","MawHB","QKKBh","hash","thwZL","EqCAR","TjOdl","ty-pitch","querySelec","XYrry","LjQNF","#decorate","target","DcJsi","lnPrl","733458lYTdfZ","prevZ","tor","rjmIP","style","rotate","4|3|6|9","SWPwx","yOKfJ","MWUtY","setRotatio","YrGFN","scale","position","636185fWPjAv","distance","XAJVl","ulPZb","object","BxHlp","nFDwT","exists","updateProj","l-name","Psgvq","BFxVj","435152hfczVm","GxPAH","key","innerWidth","domElement","eCamera","translate","ect","attach"];return(_0x48e5=function(){return n})()}!function(){for(var n=_0x15a4,e=_0x48e5();;)try{if(163452==+parseInt(n(490))*(parseInt(n(572))/2)+parseInt(n(665))/3+-parseInt(n(539))/4+-parseInt(n(552))/5*(parseInt(n(614))/6)+parseInt(n(509))/7*(-parseInt(n(475))/8)+parseInt(n(568))/9*(parseInt(n(582))/10)+-parseInt(n(679))/11*(-parseInt(n(590))/12))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();import{Post,getOwnedObjects}from"./api.js";import*as _0x1e17ab from"three";import{TransformControls}from"three/addons/controls/TransformControls.js";let decorateMenu=null,editable=!1,editingData={};function setDecorateMenu(n){decorateMenu=n}const tracking={x:0,y:0},objectInfos={},furniData={prevY:[],prevX:[],prevZ:[],prevPitch:[],prevRoll:[],prevYaw:[]};let isTransforming=!1,editingId=null;const degToRad=n=>{var e=_0x15a4,t={aPeSm:function(n,e){return n*e},hLIUa:function(n,e){return n/e}};return t[e(513)](n,t[e(630)](Math.PI,180))},radToDeg=n=>{var e=_0x15a4,t={tJhdZ:function(n,e){return n*e},XVghg:function(n,e){return n/e}};return t[e(617)](n,t[e(543)](180,Math.PI))},mouseDownHandler=async n=>{var e=_0x15a4,t={RsKBh:function(n,e){return n&&e},ZVnpY:function(n,e){return n!==e},hyNqo:e(610),qnKtM:function(n,e,t){return n(e,t)},ppRNg:e(507)+e(486),YBXwB:function(n,e){return n!==e},flQHa:function(n,e){return n!=e},yOKfJ:function(n,e){return n==e},SBkJr:function(n){return n()},qnxlJ:function(n,e){return n<e},jixtf:function(n,e){return n!=e},hfcNU:function(n,e){return n(e)},LjQNF:e(589),dVdzv:function(n,e){return n==e}};if(!(isTransforming=!t[e(500)](isTransforming,!editingId)&&isTransforming)&&!t[e(639)](n[e(662)][e(547)],t[e(493)])){var n=tracking.x,r=tracking.y,a=await t[e(628)](Post,t[e(625)],{x:n,y:r});if(a[e(550)]&&t[e(556)](editingId,a[e(563)]))if(t[e(546)](decorateMenu,null)&&t[e(673)](decorateMenu[e(554)],2)){var o=await t[e(601)](getOwnedObjects);if(!t[e(673)](o[decorateMenu[e(645)][e(604)+"u"][e(605)]][e(683)],a[e(563)])){for(var i=null,c=0;t[e(531)](c,o[e(581)]);c++)if(t[e(673)](o[c][e(683)],a[e(563)])){i=c;break}t[e(491)](i,null)&&(decorateMenu[e(645)][e(604)+"u"][e(605)]=i),decorateMenu[e(645)][e(604)+"u"][e(554)]()}}else t[e(601)](clearData),editingId=a[e(563)],t[e(536)](changeEntity,editingId),isTransforming=!1;else if(!a[e(550)]){var s=t[e(660)][e(524)]("|");let n=0;for(;;){switch(s[n++]){case"0":isTransforming=!1;continue;case"1":transformControls[e(591)]=!1;continue;case"2":editingId=null;continue;case"3":t[e(601)](clearData);continue;case"4":if(t[e(491)](decorateMenu,null)&&t[e(537)](decorateMenu[e(554)],2))return;continue}break}}}},handleTracking=(window[_0x192837(521)+_0x192837(488)](_0x192837(522),mouseDownHandler),n=>{var e=_0x192837,t={DCVfU:function(n,e){return n-e},MawHB:function(n,e){return n-e},TjOdl:function(n,e,t){return n(e,t)},QnSrM:function(n,e,t){return n(e,t)}},r=t[e(558)](n[e(523)],n[e(662)][e(640)]),n=t[e(651)](n[e(629)],n[e(662)][e(640)]);tracking.x=t[e(656)](normalize,r,document[e(649)+e(571)][e(587)+"h"]),tracking.y=t[e(508)](normalize,n,document[e(649)+e(571)][e(567)+"ht"])}),Scene=new _0x1e17ab[_0x192837(545)],Renderer=new _0x1e17ab[_0x192837(603)+_0x192837(577)]({alpha:!0}),Camera=(Renderer[_0x192837(514)](window[_0x192837(478)],window[_0x192837(530)+"t"]),document[_0x192837(658)+_0x192837(667)](_0x192837(661))[_0x192837(626)+"d"](Renderer[_0x192837(479)]),new _0x1e17ab[_0x192837(551)+_0x192837(480)](50,window[_0x192837(478)]/window[_0x192837(530)+"t"],.1,1e4)),boxGeometry=(Camera[_0x192837(594)][_0x192837(593)]=_0x192837(557),new _0x1e17ab[_0x192837(561)+"y"](1,1,1)),meshPhongMaterial=new _0x1e17ab[_0x192837(586)+_0x192837(574)]({color:16711935,transparent:!0,opacity:0}),Mesh=new _0x1e17ab[_0x192837(647)](boxGeometry,meshPhongMaterial);Mesh[_0x192837(594)][_0x192837(593)]=_0x192837(557),Mesh[_0x192837(677)][_0x192837(643)](1,1,1),Scene[_0x192837(487)](Mesh),Renderer[_0x192837(479)][_0x192837(669)][_0x192837(585)]=_0x192837(494);let animationFrameActive=null;function renderGeometry(){var n=_0x192837;animationFrameActive={CaaHF:function(n,e){return n(e)}}[n(506)](requestAnimationFrame,renderGeometry),Renderer[n(618)](Scene,Camera)}function showGeometry(){var n=_0x192837,e={jjbfy:n(588)};transformControls[n(591)]=!1,Renderer[n(479)][n(669)][n(585)]=e[n(580)]}function hideGeometry(){var n=_0x192837,e={IFchw:n(494)};transformControls[n(591)]=!1,Renderer[n(479)][n(669)][n(585)]=e[n(584)]}function hideTransformControls(){var n=_0x192837;transformControls[n(591)]=!1}const transformControls=new TransformControls(Camera,Renderer[_0x192837(479)]),editEntity=(transformControls[_0x192837(521)+_0x192837(488)](_0x192837(548),()=>{var n=_0x192837,e={YrGFN:function(n,e){return n(e)},QKKBh:function(n,e){return n(e)},afEHu:function(n,e){return n(e)},npLtk:function(n){return n()}},t=objectInfos[editingId];Mesh[n(678)].x&&Mesh[n(678)].y&&Mesh[n(678)].z&&t&&(t.x=Mesh[n(678)].x,t.y=-Mesh[n(678)].z,t.z=Mesh[n(678)].y,t[n(485)]=e[n(676)](radToDeg,Mesh[n(594)].x),t[n(595)]=e[n(652)](radToDeg,-Mesh[n(594)].z),t[n(633)]=e[n(636)](radToDeg,Mesh[n(594)].y),e[n(502)](editEntity),Renderer[n(618)](Scene,Camera))}),()=>{var n=_0x192837,e={ypOpk:function(n,e,t){return n(e,t)},wpJEH:n(492)+"y",XYrry:function(n,e){return n(e)},IsfSI:function(n,e){return n(e)},mZaTI:function(n,e){return n(e)},EqCAR:function(n,e){return n(e)},RScsN:function(n,e){return n(e)},NUymp:function(n,e){return n(e)},DdTlJ:function(n,e){return n(e)},yceOc:function(n,e){return n(e)}},t=objectInfos[editingId];e[n(495)](Post,e[n(496)],{id:editingId,alpha:e[n(659)](parseInt,t[n(607)]),x:e[n(646)](parseFloat,t.x),y:e[n(641)](parseFloat,t.y),z:e[n(655)](parseFloat,t.z),pitch:e[n(515)](parseFloat,t[n(485)]),roll:e[n(579)](parseFloat,t[n(595)]),yaw:e[n(609)](parseFloat,t[n(633)])}),e[n(555)](setObjectHelperValues,t)});function _0x15a4(n,e){const t=_0x48e5();return(_0x15a4=function(n,e){return n-=475,t[n]})(n,e)}transformControls[_0x192837(521)+_0x192837(488)](_0x192837(623),()=>{var n=_0x192837;isTransforming=!0,{sHmHH:function(n){return n()}}[n(535)](storeData)}),transformControls[_0x192837(521)+_0x192837(488)](_0x192837(549),()=>{var n=_0x192837,e=objectInfos[editingId];e&&(e.x=Mesh[n(678)].x,e.y=-Mesh[n(678)].z,e.z=Mesh[n(678)].y,isTransforming=!1)}),transformControls[_0x192837(627)+_0x192837(503)](.1),transformControls[_0x192837(514)](.8),transformControls[_0x192837(675)+_0x192837(592)](degToRad(15)),transformControls[_0x192837(483)](Mesh),Scene[_0x192837(487)](transformControls);const storeData=()=>{var e=_0x192837,t={cInWA:function(n,e){return n!==e},ixfac:e(616)+"1"},r=objectInfos[editingId];if(r&&t[e(504)](r.x,0)&&t[e(504)](r.y,0)&&t[e(504)](r.z,0)){var a=t[e(621)][e(524)]("|");let n=0;for(;;){switch(a[n++]){case"0":furniData[e(562)][e(525)](r.x);continue;case"1":furniData[e(560)][e(525)](r[e(633)]);continue;case"2":furniData[e(498)][e(525)](r[e(595)]);continue;case"3":furniData[e(666)][e(525)](r.z);continue;case"4":furniData[e(511)][e(525)](r.y);continue;case"5":furniData[e(631)][e(525)](r[e(485)]);continue}break}}};function cancelRenderGeometry(){var n=_0x192837;animationFrameActive&&({lnPrl:function(n,e){return n(e)}}[n(664)](cancelAnimationFrame,animationFrameActive),animationFrameActive=null)}function setEditMode(n){var e=_0x192837,t={DcJsi:function(n,e){return n===e},gpUVN:e(670),WmANU:e(481)};t[e(663)](n,t[e(613)])?transformControls[e(534)](t[e(613)]):transformControls[e(534)](t[e(644)])}function setRotationSnap(n){var e=_0x192837;transformControls[e(675)+e(592)](n)}function setTranslationSnap(n){var e=_0x192837;transformControls[e(627)+e(503)](n)}const normalize=(n,e)=>{var t=_0x192837,r={BtwGE:function(n,e){return n+e},GxPAH:function(n,e){return n/e},MIcmc:function(n,e){return n*e},Psgvq:function(n,e){return n-e}};return r[t(634)](r[t(476)](r[t(520)](1,r[t(689)](n,0)),r[t(689)](e,0)),0)},handleUpdatePositions=(window[_0x192837(521)+_0x192837(488)](_0x192837(542),handleTracking),n=>{var e=_0x192837,t={AOCPr:function(n,e){return n(e)},xpWpz:function(n,e){return n(e)},TStww:function(n,e,t){return n(e,t)},thwZL:function(n,e){return n(e)},BFxVj:function(n,e){return n(e)},SWPwx:function(n,e){return n(e)},WWccf:function(n,e){return n(e)}},r=(Camera[e(678)][e(643)](n[e(637)][e(678)].x,n[e(637)][e(678)].z,-n[e(637)][e(678)].y),n[e(637)][e(594)].x),a=n[e(637)][e(594)].z,o=n[e(637)][e(594)].y;Camera[e(594)][e(643)](t[e(541)](degToRad,r),t[e(648)](degToRad,t[e(583)](zRotationHandler,r,a)),t[e(654)](degToRad,o)),Camera[e(497)]=n[e(637)][e(497)],Camera[e(687)+e(532)+"ix"](),n[e(563)][e(678)]&&(Mesh[e(678)][e(643)](n[e(563)][e(678)].x,n[e(563)][e(678)].z,-n[e(563)][e(678)].y),Mesh[e(594)][e(643)](t[e(690)](degToRad,n[e(563)][e(594)].x),t[e(672)](degToRad,n[e(563)][e(594)].z),t[e(632)](degToRad,-n[e(563)][e(594)].y)))}),changeEntity=async n=>{var e=_0x192837,t={fujcI:function(n,e,t){return n(e,t)},MWUtY:e(611)+e(499),XepOw:function(n,e){return n(e)},iqPgo:function(n,e){return n(e)}},n=await t[e(540)](Post,t[e(674)],{id:t[e(619)](parseInt,n)});t[e(575)](setEntityData,n)},zRotationHandler=(n,e)=>{var t=_0x192837,r={QwSEY:function(n,e){return e<n},ISuXF:function(n,e){return n<e},LIVDl:function(n,e){return e<n},XbRyP:function(n,e){return e<n}};return(!r[t(566)](n,0)||!r[t(624)](n,90))&&(r[t(602)](n,-180)&&r[t(624)](n,-90)||r[t(600)](n,0))?-e:e},setEntityData=n=>{var e=_0x192837,t={XTMnS:e(505)+e(612)+e(608)+e(671),aludV:function(n,e){return n(e)},beJlZ:function(n,e){return n!==e},BxHlp:function(n){return n()}},r=t[e(615)][e(524)]("|");let a=0;for(;;){switch(r[a++]){case"0":editingData.y=n.y;continue;case"1":editingData[e(607)]=n[e(607)];continue;case"2":editingData.x=n.x;continue;case"3":editingData[e(680)]=n[e(680)];continue;case"4":editingData[e(653)]=n[e(653)];continue;case"5":editingId=n.id;continue;case"6":transformControls[e(591)]=!0;continue;case"7":editable=!0;continue;case"8":if(n[e(686)])continue;return editable=!1,void(transformControls[e(591)]=!1);case"9":t[e(597)](setObjectHelperValues,n);continue;case"10":editingData.z=n.z;continue;case"11":t[e(519)](editingId,n.id)&&t[e(684)](clearData);continue;case"12":editingData[e(485)]=n[e(485)];continue;case"13":editingData[e(595)]=n[e(595)];continue;case"14":editingData[e(633)]=n[e(633)];continue;case"15":objectInfos[editingId]={id:n.id,hash:n[e(653)],alpha:n[e(607)],x:n.x,y:n.y,z:n.z,pitch:n[e(485)],roll:n[e(595)],yaw:n[e(633)],distance:n[e(680)],quaternion:{}};continue}break}},setObjectHelperValues=n=>{var e=_0x192837,t={gJHpl:e(573)+e(596),rjmIP:function(n,e){return n(e)},oeWHo:e(538)+e(527)+e(512),xpGTv:e(538)+e(544)+e(688),XAJVl:function(n,e){return n(e)},BaXPk:e(538)+e(527)+e(642),qrZao:function(n,e){return n(e)},fKtKu:e(538)+e(527)+e(484),wJCJT:e(538)+e(527)+e(622),hmTTQ:e(538)+e(527)+e(489),rEZhx:e(538)+e(527)+e(657)},r=t[e(528)][e(524)]("|");let a=0;for(;;){switch(r[a++]){case"0":t[e(668)]($,t[e(564)])[e(518)](n.y);continue;case"1":t[e(668)]($,t[e(569)])[e(518)](n[e(653)]);continue;case"2":t[e(681)]($,t[e(553)])[e(518)](n.z);continue;case"3":t[e(638)]($,t[e(559)])[e(518)](n.x);continue;case"4":t[e(681)]($,t[e(501)])[e(518)](n[e(633)]);continue;case"5":t[e(668)]($,t[e(529)])[e(518)](n[e(595)]);continue;case"6":t[e(668)]($,t[e(570)])[e(518)](n[e(485)]);continue}break}},clearData=()=>{var n=_0x192837,e={gCYaf:n(620)+"1"}[n(635)][n(524)]("|");let t=0;for(;;){switch(e[t++]){case"0":furniData[n(498)]=[];continue;case"1":furniData[n(560)]=[];continue;case"2":furniData[n(666)]=[];continue;case"3":furniData[n(631)]=[];continue;case"4":furniData[n(562)]=[];continue;case"5":furniData[n(511)]=[];continue}break}};window[_0x192837(521)+_0x192837(488)](_0x192837(516),async n=>{var e=_0x192837,t={nFDwT:function(n,e){return n===e},GzKaC:function(n,e){return n(e)},mwrsr:e(650)+e(517),MHKXD:function(n,e){return n===e},AIvfu:e(510)+"or",MfuhD:function(n,e){return n===e},dJFaJ:function(n,e){return n===e},ulPZb:function(n,e,t){return n(e,t)},sbhhR:e(533)+e(482)};t[e(685)](n[e(477)],"F6")&&t[e(565)](Post,t[e(606)]),t[e(598)](n[e(477)],"F5")&&t[e(565)](Post,t[e(578)]),(t[e(526)](n[e(477)],"G")||t[e(599)](n[e(477)],"g"))&&(n=await t[e(682)](Post,t[e(576)],{id:t[e(565)](parseInt,editingId)}),t[e(565)](setEntityData,n))});export{setDecorateMenu,renderGeometry,showGeometry,hideGeometry,hideTransformControls,cancelRenderGeometry,setEditMode,setRotationSnap,setTranslationSnap,handleUpdatePositions,changeEntity};