const _0x2a4001=_0xec82;!function(){for(var n=_0xec82,e=_0x4a9f();;)try{if(163581==-parseInt(n(697))*(parseInt(n(680))/2)+-parseInt(n(548))/3+-parseInt(n(500))/4+-parseInt(n(504))/5+parseInt(n(645))/6*(-parseInt(n(617))/7)+parseInt(n(511))/8*(-parseInt(n(512))/9)+-parseInt(n(664))/10*(-parseInt(n(509))/11))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();import{Post,getOwnedObjects}from"./api.js";import*as _0x4ddba8 from"three";import{TransformControls}from"three/addons/controls/TransformControls.js";let decorateMenu=null,editable=!1,editingData={};function setDecorateMenu(n){decorateMenu=n}const tracking={x:0,y:0},objectInfos={},furniData={prevY:[],prevX:[],prevZ:[],prevPitch:[],prevRoll:[],prevYaw:[]};let isTransforming=!1,editingId=null;const degToRad=n=>{var e=_0xec82,t={bvvWU:function(n,e){return n*e},IzdHe:function(n,e){return n/e}};return t[e(618)](n,t[e(528)](Math.PI,180))},radToDeg=n=>{var e=_0xec82,t={CvykH:function(n,e){return n*e},KSQAQ:function(n,e){return n/e}};return t[e(642)](n,t[e(513)](180,Math.PI))},mouseDownHandler=async n=>{var e=_0xec82,t={VVZLw:function(n,e){return n&&e},iKJcw:function(n,e){return n!==e},FgFfF:e(596),CIuBn:function(n,e,t){return n(e,t)},QlSyl:e(670)+e(517),SeLtd:function(n,e){return n!==e},OhGYz:function(n,e){return n!=e},hsUMo:function(n,e){return n==e},DgQXe:function(n){return n()},MyOVP:function(n,e){return n==e},VjFQV:function(n,e){return n<e},AiYAA:function(n,e){return n==e},eERaz:function(n){return n()},JMfaS:function(n,e){return n(e)},enqGk:e(648),yOokv:function(n){return n()},UhgHW:function(n,e){return n==e}};if(!(isTransforming=!t[e(525)](isTransforming,!editingId)&&isTransforming)&&!t[e(601)](n[e(687)][e(653)],t[e(575)])){var n=tracking.x,a=tracking.y,r=await t[e(557)](Post,t[e(678)],{x:n,y:a});if(r[e(609)]&&t[e(626)](editingId,r[e(523)]))if(t[e(677)](decorateMenu,null)&&t[e(574)](decorateMenu[e(549)],2)){var o=await t[e(538)](getOwnedObjects);if(!t[e(571)](o[decorateMenu[e(490)][e(583)+"u"][e(501)]][e(613)],r[e(523)])){for(var i=null,c=0;t[e(639)](c,o[e(541)]);c++)if(t[e(646)](o[c][e(613)],r[e(523)])){i=c;break}t[e(677)](i,null)&&(decorateMenu[e(490)][e(583)+"u"][e(501)]=i),decorateMenu[e(490)][e(583)+"u"][e(549)]()}}else t[e(537)](clearData),editingId=r[e(523)],t[e(654)](changeEntity,editingId),isTransforming=!1;else if(!r[e(609)]){var s=t[e(625)][e(588)]("|");let n=0;for(;;){switch(s[n++]){case"0":t[e(533)](clearData);continue;case"1":if(t[e(677)](decorateMenu,null)&&t[e(657)](decorateMenu[e(549)],2))return;continue;case"2":isTransforming=!1;continue;case"3":editingId=null;continue;case"4":transformControls[e(635)]=!1;continue}break}}}},handleTracking=(window[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(576),mouseDownHandler),n=>{var e=_0x2a4001,t={OkVXV:function(n,e){return n-e},pVQhT:function(n,e,t){return n(e,t)},iWEvF:function(n,e,t){return n(e,t)}},a=t[e(675)](n[e(684)],n[e(687)][e(673)]),n=t[e(675)](n[e(494)],n[e(687)][e(673)]);tracking.x=t[e(516)](normalize,a,document[e(656)+e(581)][e(539)+"h"]),tracking.y=t[e(510)](normalize,n,document[e(656)+e(581)][e(666)+"ht"])}),Scene=new _0x4ddba8[_0x2a4001(544)],Renderer=new _0x4ddba8[_0x2a4001(598)+_0x2a4001(561)]({alpha:!0});function _0x4a9f(){const n=["roll","exists","categories","val","y_info","order","pageY","BoxGeometr","|8|0|6|13|","fov","rotation","gUTyJ","190996uMgUPY","stash","updateProj","mouseDown","1461265aNADpn","addEventLi","0|6","neaPE","querySelec","33kdiRvI","iWEvF","853168wZSYiM","9mCkhoO","KSQAQ","mousemove","scale","pVQhT","ity","MeshPhongM","ground_obj","ASYhh","prevZ","zDVeh","entity","display","VVZLw","set","15|1|5|11|","IzdHe","CoKiK","ltswr","gxsLV","UBXDz","yOokv","attach","QLXSY","appendChil","eERaz","DgQXe","scrollWidt","distance","length","IODAx","lper #enti","Scene","pitch","prevX","Bdhyu","520128JjVTXf","sort","mpxIy","edit_entit","cam","TxRZD","rotate","prevY","dqagh","CIuBn","prevPitch","mouseUp","prevYaw","rer","ZfcCk","VVytx","jfagG","ty-roll","cRTiW","HTYjU","ect","tiaai","position","MyOVP","toggleMous","eCamera","hsUMo","FgFfF","mousedown","tor","ty-z","key","Mddzm","ement","setMode","sortingMen","xAydv","keydown","style","setTransla","split","innerHeigh","FRbSQ","dkBdR","lper #mode","ZQhoV","ty-yaw","ZFebS","CANVAS","UIaal","WebGLRende","ty-x","domElement","iKJcw","XWfYZ","UveGd","CwGub","hinQz","add","prevRoll","JMaSk","hit","yltTo","ty-pitch","OUeek","object","mMItI","Rvzya","UrODn","98DMbjet","bvvWU","Ekaez","alpha","nhtAi","Mesh","YOIke","TpeZo","enqGk","SeLtd","layzV","DcwhX","ACfmi","RWySZ","none","setSize","vmbLy","2|12|10","visible","eMovement","1|0|2|5|3|","toggleCurs","VjFQV","fVZcs","HjHMO","CvykH","hash","IAiyn","127794DaQJVl","AiYAA","ectionMatr","1|0|3|4|2","innerWidth","l-name","setRotatio","#decorate","tagName","JMfaS","GviWr","documentEl","UhgHW","cIrJS","SsnQp","yaw","DwNNq","render","GLOdX","4073860ogfJgo","mrQAb","scrollHeig","translate","nSnap","tionSnap","select_ent","YZX","EQFgV","offsetTop","rJmTS","OkVXV","4|2|3|5|0|","OhGYz","QlSyl","ChsVD","2xQUESD","stener","14|3|7|9|4","change","pageX","#object-he","5|2|4|3|1|","target","goDIV","block","Perspectiv","load_entit","bTrnt","aterial","BwbXE","qRKnC","push","140367zKTQrZ","ty-y"];return(_0x4a9f=function(){return n})()}Renderer[_0x2a4001(632)](window[_0x2a4001(649)],window[_0x2a4001(589)+"t"]),document[_0x2a4001(508)+_0x2a4001(577)](_0x2a4001(652))[_0x2a4001(536)+"d"](Renderer[_0x2a4001(600)]);const Camera=new _0x4ddba8[_0x2a4001(690)+_0x2a4001(573)](50,window[_0x2a4001(649)]/window[_0x2a4001(589)+"t"],.1,1e4),boxGeometry=(Camera[_0x2a4001(498)][_0x2a4001(493)]=_0x2a4001(671),new _0x4ddba8[_0x2a4001(495)+"y"](1,1,1)),meshPhongMaterial=new _0x4ddba8[_0x2a4001(518)+_0x2a4001(693)]({color:16711935,transparent:!0,opacity:0}),Mesh=new _0x4ddba8[_0x2a4001(622)](boxGeometry,meshPhongMaterial);Mesh[_0x2a4001(498)][_0x2a4001(493)]=_0x2a4001(671),Mesh[_0x2a4001(515)][_0x2a4001(526)](1,1,1),Scene[_0x2a4001(606)](Mesh),Renderer[_0x2a4001(600)][_0x2a4001(586)][_0x2a4001(524)]=_0x2a4001(631);let animationFrameActive=null;function renderGeometry(){var n=_0x2a4001;animationFrameActive={UIaal:function(n,e){return n(e)}}[n(597)](requestAnimationFrame,renderGeometry),Renderer[n(662)](Scene,Camera)}function showGeometry(){var n=_0x2a4001,e={zDVeh:n(689)};transformControls[n(635)]=!1,Renderer[n(600)][n(586)][n(524)]=e[n(522)]}function hideGeometry(){var n=_0x2a4001,e={cIrJS:n(631)};transformControls[n(635)]=!1,Renderer[n(600)][n(586)][n(524)]=e[n(658)]}function hideTransformControls(){var n=_0x2a4001;transformControls[n(635)]=!1}const transformControls=new TransformControls(Camera,Renderer[_0x2a4001(600)]),editEntity=(transformControls[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(683),()=>{var n=_0x2a4001,e={nhtAi:function(n,e){return n(e)},vmbLy:function(n,e){return n(e)},HjHMO:function(n){return n()}},t=objectInfos[editingId];Mesh[n(570)].x&&Mesh[n(570)].y&&Mesh[n(570)].z&&t&&(t.x=Mesh[n(570)].x,t.y=-Mesh[n(570)].z,t.z=Mesh[n(570)].y,t[n(545)]=e[n(621)](radToDeg,Mesh[n(498)].x),t[n(488)]=e[n(621)](radToDeg,-Mesh[n(498)].z),t[n(660)]=e[n(633)](radToDeg,Mesh[n(498)].y),e[n(641)](editEntity),Renderer[n(662)](Scene,Camera))}),()=>{var n=_0x2a4001,e={gUTyJ:function(n,e,t){return n(e,t)},tiaai:n(551)+"y",ZfcCk:function(n,e){return n(e)},Rvzya:function(n,e){return n(e)},fVZcs:function(n,e){return n(e)},ltswr:function(n,e){return n(e)}},t=objectInfos[editingId];e[n(499)](Post,e[n(569)],{id:editingId,alpha:e[n(562)](parseInt,t[n(620)]),x:e[n(615)](parseFloat,t.x),y:e[n(640)](parseFloat,t.y),z:e[n(640)](parseFloat,t.z),pitch:e[n(615)](parseFloat,t[n(545)]),roll:e[n(530)](parseFloat,t[n(488)]),yaw:e[n(562)](parseFloat,t[n(660)])}),e[n(615)](setObjectHelperValues,t)});function _0xec82(n,e){const t=_0x4a9f();return(_0xec82=function(n,e){return n-=487,t[n]})(n,e)}transformControls[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(503),()=>{var n=_0x2a4001;isTransforming=!0,{IAiyn:function(n){return n()}}[n(644)](storeData)}),transformControls[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(559),()=>{var n=_0x2a4001,e=objectInfos[editingId];e&&(e.x=Mesh[n(570)].x,e.y=-Mesh[n(570)].z,e.z=Mesh[n(570)].y,isTransforming=!1)}),transformControls[_0x2a4001(587)+_0x2a4001(669)](.1),transformControls[_0x2a4001(632)](.8),transformControls[_0x2a4001(651)+_0x2a4001(668)](degToRad(15)),transformControls[_0x2a4001(534)](Mesh),Scene[_0x2a4001(606)](transformControls);const storeData=()=>{var e=_0x2a4001,t={ASYhh:function(n,e){return n!==e},ACfmi:function(n,e){return n!==e},ZQhoV:function(n,e){return n!==e},BwbXE:e(637)+"4"},a=objectInfos[editingId];if(a&&t[e(520)](a.x,0)&&t[e(629)](a.y,0)&&t[e(593)](a.z,0)){var r=t[e(694)][e(588)]("|");let n=0;for(;;){switch(r[n++]){case"0":furniData[e(555)][e(696)](a.y);continue;case"1":furniData[e(546)][e(696)](a.x);continue;case"2":furniData[e(521)][e(696)](a.z);continue;case"3":furniData[e(607)][e(696)](a[e(488)]);continue;case"4":furniData[e(560)][e(696)](a[e(660)]);continue;case"5":furniData[e(558)][e(696)](a[e(545)]);continue}break}}};function cancelRenderGeometry(){var n=_0x2a4001;animationFrameActive&&({GviWr:function(n,e){return n(e)}}[n(655)](cancelAnimationFrame,animationFrameActive),animationFrameActive=null)}function setEditMode(n){var e=_0x2a4001,t={SsnQp:function(n,e){return n===e},bTrnt:e(554),FRbSQ:e(667)};t[e(659)](n,t[e(692)])?transformControls[e(582)](t[e(692)]):transformControls[e(582)](t[e(590)])}function setRotationSnap(n){var e=_0x2a4001;transformControls[e(651)+e(668)](n)}function setTranslationSnap(n){var e=_0x2a4001;transformControls[e(587)+e(669)](n)}const normalize=(n,e)=>{var t=_0x2a4001,a={gxsLV:function(n,e){return n+e},UrODn:function(n,e){return n/e},CwGub:function(n,e){return n*e},TpeZo:function(n,e){return n-e}};return a[t(531)](a[t(616)](a[t(604)](1,a[t(624)](n,0)),a[t(624)](e,0)),0)},handleUpdatePositions=(window[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(514),handleTracking),n=>{var e=_0x2a4001,t={UBXDz:function(n,e){return n(e)},ZFebS:function(n,e){return n(e)},Ekaez:function(n,e,t){return n(e,t)}},a=(Camera[e(570)][e(526)](n[e(552)][e(570)].x,n[e(552)][e(570)].z,-n[e(552)][e(570)].y),n[e(552)][e(498)].x),r=n[e(552)][e(498)].z,o=n[e(552)][e(498)].y;Camera[e(498)][e(526)](t[e(532)](degToRad,a),t[e(595)](degToRad,t[e(619)](zRotationHandler,a,r)),t[e(532)](degToRad,o)),Camera[e(497)]=n[e(552)][e(497)],Camera[e(502)+e(647)+"ix"](),n[e(523)][e(570)]&&(Mesh[e(570)][e(526)](n[e(523)][e(570)].x,n[e(523)][e(570)].z,-n[e(523)][e(570)].y),Mesh[e(498)][e(526)](t[e(532)](degToRad,n[e(523)][e(498)].x),t[e(595)](degToRad,n[e(523)][e(498)].z),t[e(532)](degToRad,-n[e(523)][e(498)].y)))}),changeEntity=async n=>{var e=_0x2a4001,t={CoKiK:function(n,e,t){return n(e,t)},mMItI:e(691)+e(492),jfagG:function(n,e){return n(e)},XWfYZ:function(n,e){return n(e)}},n=await t[e(529)](Post,t[e(614)],{id:t[e(564)](parseInt,n)});t[e(602)](setEntityData,n)},zRotationHandler=(n,e)=>{var t=_0x2a4001,a={OUeek:function(n,e){return e<n},hinQz:function(n,e){return n<e},dqagh:function(n,e){return e<n}};return(!a[t(612)](n,0)||!a[t(605)](n,90))&&(a[t(612)](n,-180)&&a[t(605)](n,-90)||a[t(556)](n,0))?-e:e},setEntityData=n=>{var e=_0x2a4001,t={Bdhyu:e(682)+e(496)+e(527)+e(634),RWySZ:function(n,e){return n!==e},rJmTS:function(n){return n()},TxRZD:function(n,e){return n(e)}},a=t[e(547)][e(588)]("|");let r=0;for(;;){switch(a[r++]){case"0":editingData[e(620)]=n[e(620)];continue;case"1":editingData[e(545)]=n[e(545)];continue;case"2":editingData[e(540)]=n[e(540)];continue;case"3":t[e(630)](editingId,n.id)&&t[e(674)](clearData);continue;case"4":objectInfos[editingId]={id:n.id,hash:n[e(643)],alpha:n[e(620)],x:n.x,y:n.y,z:n.z,pitch:n[e(545)],roll:n[e(488)],yaw:n[e(660)],distance:n[e(540)],quaternion:{}};continue;case"5":editingData[e(488)]=n[e(488)];continue;case"6":editingData.x=n.x;continue;case"7":editable=!0;continue;case"8":editingData[e(643)]=n[e(643)];continue;case"9":editingId=n.id;continue;case"10":t[e(553)](setObjectHelperValues,n);continue;case"11":editingData[e(660)]=n[e(660)];continue;case"12":transformControls[e(635)]=!0;continue;case"13":editingData.y=n.y;continue;case"14":if(n[e(489)])continue;return editable=!1,void(transformControls[e(635)]=!1);case"15":editingData.z=n.z;continue}break}},setObjectHelperValues=n=>{var e=_0x2a4001,t={ChsVD:e(686)+e(506),IODAx:function(n,e){return n(e)},DwNNq:e(685)+e(543)+e(565),GLOdX:function(n,e){return n(e)},QLXSY:e(685)+e(543)+e(611),EQFgV:e(685)+e(543)+e(599),VVytx:function(n,e){return n(e)},mrQAb:e(685)+e(543)+e(578),DcwhX:function(n,e){return n(e)},JMaSk:e(685)+e(543)+e(487),xAydv:function(n,e){return n(e)},YOIke:e(685)+e(592)+e(650),HTYjU:function(n,e){return n(e)},dkBdR:e(685)+e(543)+e(594)},a=t[e(679)][e(588)]("|");let r=0;for(;;){switch(a[r++]){case"0":t[e(542)]($,t[e(661)])[e(491)](n[e(488)]);continue;case"1":t[e(663)]($,t[e(535)])[e(491)](n[e(545)]);continue;case"2":t[e(542)]($,t[e(672)])[e(491)](n.x);continue;case"3":t[e(563)]($,t[e(665)])[e(491)](n.z);continue;case"4":t[e(628)]($,t[e(608)])[e(491)](n.y);continue;case"5":t[e(584)]($,t[e(623)])[e(491)](n[e(643)]);continue;case"6":t[e(567)]($,t[e(591)])[e(491)](n[e(660)]);continue}break}},clearData=()=>{var n=_0x2a4001,e={Mddzm:n(676)+"1"}[n(580)][n(588)]("|");let t=0;for(;;){switch(e[t++]){case"0":furniData[n(607)]=[];continue;case"1":furniData[n(560)]=[];continue;case"2":furniData[n(546)]=[];continue;case"3":furniData[n(521)]=[];continue;case"4":furniData[n(555)]=[];continue;case"5":furniData[n(558)]=[];continue}break}};window[_0x2a4001(505)+_0x2a4001(681)](_0x2a4001(585),async n=>{var e=_0x2a4001,t={layzV:function(n,e){return n===e},neaPE:function(n,e){return n(e)},goDIV:e(572)+e(636),qRKnC:function(n,e){return n(e)},mpxIy:e(638)+"or",cRTiW:function(n,e,t){return n(e,t)},UveGd:e(519)+e(568),yltTo:function(n,e){return n(e)}};t[e(627)](n[e(579)],"F6")&&t[e(507)](Post,t[e(688)]),t[e(627)](n[e(579)],"F5")&&t[e(695)](Post,t[e(550)]),(t[e(627)](n[e(579)],"G")||t[e(627)](n[e(579)],"g"))&&(n=await t[e(566)](Post,t[e(603)],{id:t[e(695)](parseInt,editingId)}),t[e(610)](setEntityData,n))});export{setDecorateMenu,renderGeometry,showGeometry,hideGeometry,hideTransformControls,cancelRenderGeometry,setEditMode,setRotationSnap,setTranslationSnap,handleUpdatePositions,changeEntity};